<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Weakref &#8212; Bibliothèques Python 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Creative Commons Attribution-ShareAlike 4.0 International" href="../licence.html" />
    <link rel="prev" title="unittest, doctest, mock" href="../unittest/index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="weakref">
<span id="weakref-tutorial"></span><h1>Weakref<a class="headerlink" href="#weakref" title="Permalink to this headline">¶</a></h1>
<p>Par Anthony gillioz <a class="footnote-reference" href="#ya" id="id1">[1]</a></p>
<div class="section" id="introductions">
<h2>Introductions<a class="headerlink" href="#introductions" title="Permalink to this headline">¶</a></h2>
<p><strong>Weakref</strong> est un module de python qui permet au programmeur de créer des réference faibles sur des objets. Une référence faible sur un objet ne va pas garder cet objet en vie, si les seuls références sur cet object est une weakref,
le garbage collector est alors libre de détruire l&#8217;objet référencé. Ce qui ne pourai pas être faisable avec des références forte.</p>
<div class="section" id="reference-forte">
<h3>Référence (forte)<a class="headerlink" href="#reference-forte" title="Permalink to this headline">¶</a></h3>
<p>En python, tous les objets, dans tous les cas sont accèdé par références. Les références sont des pointeurs sur des objets, ils vont pointer à l&#8217;endroit ou se trouve l&#8217;objet en mémoire.
Il y a aussi un compteur de référence qui va s&#8217;incrémenté à chaque fois qu&#8217;une référence est créée sur un objet, et c&#8217;est seulement quand ce compteur est à zéro que l&#8217;objet va être détruit par le garbage collector.</p>
</div>
<div class="section" id="reference-faible">
<h3>Référence faible<a class="headerlink" href="#reference-faible" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Tous les objects ne supporte pas les weakref. Par exemple les list et les dict ne supporte pas directement les weakref mais peuvent le faire si l&#8217;on les sous classe. Pour plus d&#8217;information sur les objets supporter <a class="reference external" href="https://docs.python.org/3/extending/newtypes.html#weakref-support">Weakref support</a></p>
</div>
</div>
<div class="section" id="garbage-collector">
<h3>Garbage collector<a class="headerlink" href="#garbage-collector" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="exemple-d-utilisation">
<h2>Exemple d&#8217;utilisation<a class="headerlink" href="#exemple-d-utilisation" title="Permalink to this headline">¶</a></h2>
<p>Dans cet exemple nous allons montrer l&#8217;utilité que peut avoir l&#8217;utilisation des weakref. Prenons la classe trivial ci-dessous:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleWeakref</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
 <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="nb">print</span> <span class="s1">&#39;created&#39;</span>

 <span class="k">def</span> <span class="nf">__destroy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="nb">print</span> <span class="s1">&#39;destroy&#39;</span>
</pre></div>
</div>
<p>Et que nous executons le code ci-dessous, avec des références fortes sur les objets créer. Il faut que les deux références sur l&#8217;objet sois détruite pour que le garbage collector libère la mémoire de l&#8217;objet.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ExampleWeakref</span><span class="p">()</span>
<span class="go">created</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">b</span>
<span class="go">destroyed</span>
</pre></div>
</div>
<p>Alors que si nous n&#8217;avions qu&#8217;une seul référence forte sur l&#8217;objet et une faible comme dans l&#8217;exemple ci-dessous. La supression ce fait directement après la destruction de la référence forte. Grace à cela nous pouvons savoir exactement quand l&#8217;espace mémoire sera libéré.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ExampleWeakref</span><span class="p">()</span>
<span class="go">created</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a</span>
<span class="go">destroyed</span>
</pre></div>
</div>
</div>
<div class="section" id="exemple-n2">
<h2>Exemple n°2<a class="headerlink" href="#exemple-n2" title="Permalink to this headline">¶</a></h2>
<p>L&#8217;utilité des weakref n&#8217;est pas des plus optimal dans cet exemple basic. Nous allons donc maintenant rajouter une méthode à notre class. Ce qui va nous permettre d&#8217;experimenter les références cyclique (c&#8217;est un objet qui a dans ces propriété une référence au même type que lui).</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleWeakref</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
 <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="nb">print</span> <span class="s1">&#39;created&#39;</span>
     <span class="o">...</span>
 <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
</pre></div>
</div>
<p>Maintenant si nous tentons de faire des références cyclique sur notre objet. Les destructeurs de nos objets a et b ne sont jamais appelé</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">ExampleWeakref</span><span class="p">()</span>
<span class="go">created</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">ExampleWeakref</span><span class="p">()</span>
<span class="go">created</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">b</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="ya" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>&lt;<a class="reference external" href="mailto:anthony&#46;gillioz&#37;&#52;&#48;he-arc&#46;ch">anthony<span>&#46;</span>gillioz<span>&#64;</span>he-arc<span>&#46;</span>ch</a>&gt;</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Weakref</a><ul>
<li><a class="reference internal" href="#introductions">Introductions</a><ul>
<li><a class="reference internal" href="#reference-forte">Référence (forte)</a></li>
<li><a class="reference internal" href="#reference-faible">Référence faible</a></li>
<li><a class="reference internal" href="#garbage-collector">Garbage collector</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exemple-d-utilisation">Exemple d&#8217;utilisation</a></li>
<li><a class="reference internal" href="#exemple-n2">Exemple n°2</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../unittest/index.html" title="Chapitre précédent"><code class="docutils literal"><span class="pre">unittest</span></code>, <code class="docutils literal"><span class="pre">doctest</span></code>, <code class="docutils literal"><span class="pre">mock</span></code></a></li>
      <li>Next: <a href="../licence.html" title="Chapitre suivant">Creative Commons Attribution-ShareAlike 4.0 International</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/weakref/index.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, HE-Arc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/weakref/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>