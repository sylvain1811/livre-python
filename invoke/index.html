<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>invoke &#8212; Bibliothèques Python 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="json" href="../json/index.html" />
    <link rel="prev" title="itertools" href="../itertools/index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="invoke">
<span id="invoke-tutorial"></span><h1>invoke<a class="headerlink" href="#invoke" title="Permalink to this headline">¶</a></h1>
<p>Par Jonathan Guerne <a class="footnote-reference" href="#email" id="id1">[1]</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>L&#8217;utilité de <a class="reference external" href="http://www.pyinvoke.org/">Invoke</a> est de pouvoir très simplement lancer des tâches que vous
aurez déjà préparé au pare avant et qui exécuteront par exemple des lignes de
commande.</p>
<p>Invoke se veut facile à prendre en main mais puissant à utiliser. Ce qui signifie
que l&#8217;on peut l&#8217;utiliser dans le cas où l&#8217;on souhaite simplement lancer une commande simple :</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">ouverture</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bonjour&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ou alors pour des groupes de tâches plus complexe pouvant également utiliser des
arguments.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">which</span> <span class="o">=</span> <span class="n">which</span> <span class="ow">or</span> <span class="s1">&#39;pyc&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cleaning </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">which</span><span class="p">))</span>

 <span class="nd">@task</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)])</span> <span class="c1"># or call(clean, &#39;all&#39;)</span>
 <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Code source tiré de la <a class="reference external" href="http://docs.pyinvoke.org/en/latest/">documentation</a>  officielle de invoke.</p>
</div>
<div class="section" id="exemple">
<h2>Exemple<a class="headerlink" href="#exemple" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lancer-une-tache">
<h3>lancer une tâche<a class="headerlink" href="#lancer-une-tache" title="Permalink to this headline">¶</a></h3>
<p>Dans un projets simple il est préférable de stocker les tâches dans un fichier nommé <code class="docutils literal"><span class="pre">tasks.py</span></code> (le nom du fichier est important).
Il est cependant possible de stocker des tâches dans plusieurs fichiers en utilisant des namespaces</p>
<p>Le fichier <code class="docutils literal"><span class="pre">tasks.py</span></code> doit commencer par importer les éléments invoke dont il va
avoir besoin. Cela est fait avec la ligne suivante :</p>
<div class="code python3 highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="k">import</span> <span class="n">task</span>
</pre></div>
</div>
<p>Task est l&#8217;élément essentiel à la création de tâche avec Invoke, il faudra pratiquement toujours
l&#8217;importer.</p>
<p>On arrive à l&#8217;écriture de la tâche en elle-même. Sa sytaxe est très proche de
celle d&#8217;une simple fonction :</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;do stuff&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>La seule nouveauté quand on a déjà codé des fonctions en python est la ligne <code class="docutils literal"><span class="pre">&#64;task</span></code> précédant
la fonction elle-même. Comme on peut le voir sur l&#8217;exemple il est tout à fait possible d&#8217;utiliser
des paramètres pour influencer le comportement de sa tâche.</p>
<p>Une fois les tâches écrites on peut lancer un invite de commande afin de les tester.
Pour pouvoir savoir quelle tâches sont disponible pour notre projet on peut utiliser la commande suivante
pour les lister :</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> invoke -l
</pre></div>
</div>
<p>Maintenant, si on veut lancer la tâche <strong>build</strong> il faut le faire de cette façon :</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> invoke build
</pre></div>
</div>
<p>Si on a envie d&#8217;obtenir de l&#8217;aide sur la commande <strong>build</strong> notamment ses paramètres on utilise
cette commande :</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> invoke --help build
</pre></div>
</div>
<p>Finalement pour lancer une commande en lui spécifiant ses arguments il faut écrire ceci :</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> invoke build -args lalala
</pre></div>
</div>
<p>Ici on passe comme paramètre args la valeur <code class="docutils literal"><span class="pre">&quot;lalala&quot;</span></code>. Par défaut les
paramètres sont interprétés comme des chaînes de caractères.</p>
</div>
<div class="section" id="lancer-une-commande">
<h3>Lancer une commande<a class="headerlink" href="#lancer-une-commande" title="Permalink to this headline">¶</a></h3>
<p>En guise d&#8217;exemple nous allons ici étudier comment utiliser Invoke pour pouvoir
faciliter l&#8217;utilisation de la librairie sphinx en générant des pages HTML avec des
fichiers écrits au format rst (comme celui-ci)</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Module basic sphinx generation.&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">invoke</span> <span class="k">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">task</span>


<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generation de l&#39;html en fonction des rst.&quot;&quot;&quot;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;sphinx-build -b html source build/html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>La première ligne sert évidemment à importer les éléments de la librairies Invoke
avec lesquels on désir travailler. Ici en l&#8217;occurence comme dans tous les programme utilisant
les <code class="docutils literal"><span class="pre">&#64;task</span></code> de Invok on importe <strong>task</strong>, on va également importer <strong>run</strong> qui va nous permettre
de lancer nos commandes.</p>
<p>Le code en lui-même est très simple est au final ne contient pas beaucoup plus de ligne
que le premier exemple présenter en haut de ce document. La seule subtilité est que
pour pouvoir lancer une commande on va devoir utiliser un contexte (ici appelé <strong>ctx</strong>)
qui sera placé en argument de la tâche. Il suffit ensuite d&#8217;appelé la méthode run dans
le contexte et de passer en argument une chaîne de caractère pour lancer la commande.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Sous windows on peut rencontrer des problèmes au lancement des commandes.
En effet il est possible que Invoke ait besoin de connaître l&#8217;adresse de
l&#8217;invite de commande à utiliser. Pour cela on va mettre en place un fichier de
configuration contenant cette information (cf. <a class="reference external" href="https://github.com/pyinvoke/invoke/issues/345">WinError_3</a>)</p>
</div>
<p>On peut également mettre en place un système plus poussé qui va par exemple nettoyer
le dossier de destination avant de générer le contenu HTML</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Nettoyage du dossier de destination.&quot;&quot;&quot;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;rm -rf build/html&quot;</span><span class="p">)</span>


<span class="nd">@task</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generation de l&#39;html.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;sphinx-build -b html source build/html&quot;</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


</pre></div>
</td></tr></table></div>
<p>Pour qu&#8217;une tâche A appelle une tâche B avant son exécution il suffit d&#8217;utiliser la
syntaxe suivante.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">B</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;task B&quot;</span><span class="p">)</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">A</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;task A&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Si un appel à la tâche A est fait, la sortie sera la suivante :</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> invoke A
<span class="go">task B</span>
<span class="go">task A</span>
</pre></div>
</div>
<p>Finalement il peut être intéressant de savoir que l’on peut tester l’exécution
d’une commande. Son comportement sera le suivant :
Retourne <code class="docutils literal"><span class="pre">True</span></code> s’il n’y a pas eu d’erreur et <code class="docutils literal"><span class="pre">False</span></code> sinon.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;your command&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="autres-cas-concrets">
<h3>Autres cas concrets<a class="headerlink" href="#autres-cas-concrets" title="Permalink to this headline">¶</a></h3>
<p>Dans le cadre de l&#8217;écriture de ce livre python il m&#8217;a été proposé pour expérimenter
<strong>Invoke</strong> d&#8217;automatiser la génération de la doc html (vu au chapitre précédent) et
les checks du code et de la doc.</p>
<p>Les checks restent simple à mettre en place car il s&#8217;agit uniquement de commande à lancer
on ne cherche pas ici à avoir un comportement différent selon leur résultat</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">checks</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fait les différents checks du programme.&quot;&quot;&quot;</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;pycodestyle source&quot;</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;pydocstyle source&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Exécuter une commande va retourner un objet <a class="reference external" href="http://docs.pyinvoke.org/en/latest/api/runners.html#invoke.runners.Runner" title="(in Invoke v)"><code class="xref py py-class docutils literal"><span class="pre">Runner</span></code></a>
il possède différents attributs tel que par exemple le retour de la commande
(ainsi que l’erreur) qui peut permettre de choisir une action à réaliser en
fonction de son contenu.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.pyinvoke.org/">Invoke</a> est un outil très puissant, il est très utile par exemple pour automatiser
des processus fastidieux dans la réalisation d&#8217;un projet. Au-delà de l&#8217;automatisation
utilisé <strong>Invoke</strong> permet de lancer n&#8217;importe quelle commande standard de l&#8217;invite de commande
ce qui offre des possibilités immenses en termes par exemple de partage d&#8217;informations
entre plusieurs applications.</p>
<table class="docutils footnote" frame="void" id="email" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>&lt;<a class="reference external" href="mailto:jonathan&#46;guerne&#37;&#52;&#48;he-arc&#46;ch">jonathan<span>&#46;</span>guerne<span>&#64;</span>he-arc<span>&#46;</span>ch</a>&gt;</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">invoke</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#exemple">Exemple</a><ul>
<li><a class="reference internal" href="#lancer-une-tache">lancer une tâche</a></li>
<li><a class="reference internal" href="#lancer-une-commande">Lancer une commande</a></li>
<li><a class="reference internal" href="#autres-cas-concrets">Autres cas concrets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../itertools/index.html" title="Chapitre précédent"><code class="docutils literal"><span class="pre">itertools</span></code></a></li>
      <li>Next: <a href="../json/index.html" title="Chapitre suivant"><code class="docutils literal"><span class="pre">json</span></code></a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/invoke/index.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, HE-Arc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/invoke/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>